<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/img/cat.jpg"><title>js进阶知识梳理 | Vito's blog</title><meta name="description" content="vito的个人网站">
    <link rel="preload" href="/assets/style-C-SQpi1C.css" as="style"><link rel="stylesheet" href="/assets/style-C-SQpi1C.css">
    <link rel="modulepreload" href="/assets/app-DC0QBOlX.js"><link rel="modulepreload" href="/assets/jsPlus.html-C_vX4w6R.js">
    <link rel="prefetch" href="/assets/index.html-j4lwtS4n.js" as="script"><link rel="prefetch" href="/assets/guide.html-qb51sS0k.js" as="script"><link rel="prefetch" href="/assets/UbuntuUsingNode.html-CgHN1Zyo.js" as="script"><link rel="prefetch" href="/assets/gitUseNote.html-c57Rs0XZ.js" as="script"><link rel="prefetch" href="/assets/index.html-D2yKjUuR.js" as="script"><link rel="prefetch" href="/assets/小新pro14ACH安装Ubuntu并美化.html-msjN0Vlg.js" as="script"><link rel="prefetch" href="/assets/10sortedAlgorithm.html-DhGVPSsu.js" as="script"><link rel="prefetch" href="/assets/common.html-B4AV3I3P.js" as="script"><link rel="prefetch" href="/assets/index.html-B7Zbiw7z.js" as="script"><link rel="prefetch" href="/assets/labuladongNote.html-DKkhZVY0.js" as="script"><link rel="prefetch" href="/assets/leetcode100.html-CI-VIbgC.js" as="script"><link rel="prefetch" href="/assets/python_sword_for_offer.html-faSio3Si.js" as="script"><link rel="prefetch" href="/assets/tsClassicTop10SortAlgorithm.html-DyF9z0RS.js" as="script"><link rel="prefetch" href="/assets/tsSword4Offer.html-D38dfdvP.js" as="script"><link rel="prefetch" href="/assets/browser.html-B8kzIuHr.js" as="script"><link rel="prefetch" href="/assets/index.html-B8NpU3mP.js" as="script"><link rel="prefetch" href="/assets/index.html-CJux9hDp.js" as="script"><link rel="prefetch" href="/assets/index.html-DnVIAaye.js" as="script"><link rel="prefetch" href="/assets/npm-note.html-BT_seyYA.js" as="script"><link rel="prefetch" href="/assets/html5.html-CnKDpXEn.js" as="script"><link rel="prefetch" href="/assets/html进阶.html-CTAMcj0T.js" as="script"><link rel="prefetch" href="/assets/index.html-BqoKnHeM.js" as="script"><link rel="prefetch" href="/assets/longList.html-D0oTiII0.js" as="script"><link rel="prefetch" href="/assets/webSafe.html-aaYKehl0.js" as="script"><link rel="prefetch" href="/assets/abstract.html-CgJCXs1Q.js" as="script"><link rel="prefetch" href="/assets/auto-app.html-D7uFfsH1.js" as="script"><link rel="prefetch" href="/assets/wechat-miniAppBase.html-CLSxXPxU.js" as="script"><link rel="prefetch" href="/assets/jsBase.html-C8m9iT6v.js" as="script"><link rel="prefetch" href="/assets/jsHand.html-C-wh8R1d.js" as="script"><link rel="prefetch" href="/assets/qiankun.html-BZl4n4JF.js" as="script"><link rel="prefetch" href="/assets/axios.html-7vnSF9EB.js" as="script"><link rel="prefetch" href="/assets/index.html-xV0bopgC.js" as="script"><link rel="prefetch" href="/assets/webNetwork.html-CC6gJPc2.js" as="script"><link rel="prefetch" href="/assets/index.html-D8EA7jKX.js" as="script"><link rel="prefetch" href="/assets/express.html-DkZQf3b2.js" as="script"><link rel="prefetch" href="/assets/koa基础.html-ElybrEJI.js" as="script"><link rel="prefetch" href="/assets/next.html-CP5AigA4.js" as="script"><link rel="prefetch" href="/assets/react-base.html-DIlQurSj.js" as="script"><link rel="prefetch" href="/assets/index.html-DDojoU86.js" as="script"><link rel="prefetch" href="/assets/伯恩斯新情绪疗法.html-C4O_q5HE.js" as="script"><link rel="prefetch" href="/assets/伯恩斯新情绪疗法2.html-B169ju40.js" as="script"><link rel="prefetch" href="/assets/伯恩斯新情绪疗法3.html---04IuDQ.js" as="script"><link rel="prefetch" href="/assets/依恋的形成.html-C9ybGas1.js" as="script"><link rel="prefetch" href="/assets/穷查理宝典读书笔记.html-DhWbBaRO.js" as="script"><link rel="prefetch" href="/assets/index.html-DuvOPKFD.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ1uUMFT.js" as="script"><link rel="prefetch" href="/assets/Pinia.html-B1xW5y-1.js" as="script"><link rel="prefetch" href="/assets/vue2base.html-CI5ps21s.js" as="script"><link rel="prefetch" href="/assets/vue3plus.html-BpmEQ529.js" as="script"><link rel="prefetch" href="/assets/webpack5Note.html-DNildh6l.js" as="script"><link rel="prefetch" href="/assets/webpackNote.html-DmluIKbQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DeQKEWMY.js" as="script"><link rel="prefetch" href="/assets/index.html-pCZmrHqT.js" as="script"><link rel="prefetch" href="/assets/index.html-1gcJ0_hZ.js" as="script"><link rel="prefetch" href="/assets/index.html--8Za_afR.js" as="script"><link rel="prefetch" href="/assets/index.html-DrBG3C6M.js" as="script"><link rel="prefetch" href="/assets/index.html--l1sn5Ch.js" as="script"><link rel="prefetch" href="/assets/index.html-BubQBP2E.js" as="script"><link rel="prefetch" href="/assets/addInfo.html-DUL3swTR.js" as="script"><link rel="prefetch" href="/assets/guide.html-D5-7gRWZ.js" as="script"><link rel="prefetch" href="/assets/additionalInfo.html-Db2GhYZL.js" as="script"><link rel="prefetch" href="/assets/guide.html-C8ggRtR5.js" as="script"><link rel="prefetch" href="/assets/addInfo.html-Y_MTG9GN.js" as="script"><link rel="prefetch" href="/assets/guide.html-BSPPklfY.js" as="script"><link rel="prefetch" href="/assets/guide.html-B2KEg6hu.js" as="script"><link rel="prefetch" href="/assets/resource.html-CjH1DxBS.js" as="script"><link rel="prefetch" href="/assets/guide.html-DfDcl_tZ.js" as="script"><link rel="prefetch" href="/assets/guide.html-BfZnxOZu.js" as="script"><link rel="prefetch" href="/assets/resourcce.html-DvD8acCk.js" as="script"><link rel="prefetch" href="/assets/guide.html-D1qeMhsa.js" as="script"><link rel="prefetch" href="/assets/guide.html-DPO5eDiG.js" as="script"><link rel="prefetch" href="/assets/guide.html-CI9IOWFY.js" as="script"><link rel="prefetch" href="/assets/guide.html-CsAfbHqs.js" as="script"><link rel="prefetch" href="/assets/resource.html-Cd7aE-P9.js" as="script"><link rel="prefetch" href="/assets/guide.html-DWMQY8Vm.js" as="script"><link rel="prefetch" href="/assets/guide.html-BcB3GVBB.js" as="script"><link rel="prefetch" href="/assets/guide.html-CrTtVfSJ.js" as="script"><link rel="prefetch" href="/assets/HKShingMunReservoir.html-C0APQ0Fg.js" as="script"><link rel="prefetch" href="/assets/addInfo.html-BKpfggLz.js" as="script"><link rel="prefetch" href="/assets/guide.html-sXdDxql1.js" as="script"><link rel="prefetch" href="/assets/guide.html-Dbtm5g_Q.js" as="script"><link rel="prefetch" href="/assets/resource.html-DySKw5Lm.js" as="script"><link rel="prefetch" href="/assets/guide.html-CtxN4am5.js" as="script"><link rel="prefetch" href="/assets/orgin.html-CwdBXMoB.js" as="script"><link rel="prefetch" href="/assets/outputGuide.html-B5fdqgYl.js" as="script"><link rel="prefetch" href="/assets/index.html-Wo-PazV3.js" as="script"><link rel="prefetch" href="/assets/index.html-Ci1SzJaI.js" as="script"><link rel="prefetch" href="/assets/mustache.html-gHIgmxVS.js" as="script"><link rel="prefetch" href="/assets/reactive.html-BpuZoRpi.js" as="script"><link rel="prefetch" href="/assets/vDom.html-BEv3dvV4.js" as="script"><link rel="prefetch" href="/assets/index.html-BavR97Z1.js" as="script"><link rel="prefetch" href="/assets/index.html-DKTYnGRp.js" as="script"><link rel="prefetch" href="/assets/index.html-Cqefv2Js.js" as="script"><link rel="prefetch" href="/assets/404.html-B1at9xpo.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">Vito&#39;s blog</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaScript"><span class="title">JavaScript</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaScript"><span class="title">JavaScript</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/jsBase.html" aria-label="js基础"><!--[--><!--[--><!--]--><!--]-->js基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/es6_/" aria-label="es6+基础"><!--[--><!--[--><!--]--><!--]-->es6+基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/js/jsPlus.html" aria-label="js进阶"><!--[--><!--[--><!--]--><!--]-->js进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/jsHand.html" aria-label="js手写系列"><!--[--><!--[--><!--]--><!--]-->js手写系列<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/typescript/" aria-label="typescript"><!--[--><!--[--><!--]--><!--]-->typescript<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>js读书笔记</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/js/jsAsync/" aria-label="js异步编程"><!--[--><!--[--><!--]--><!--]-->js异步编程<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/js/jsDeep/" aria-label="你不知道的js系列"><!--[--><!--[--><!--]--><!--]-->你不知道的js系列<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue2base.html" aria-label="vue2基础"><!--[--><!--[--><!--]--><!--]-->vue2基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue2plus/" aria-label="vue2进阶"><!--[--><!--[--><!--]--><!--]-->vue2进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue3base/" aria-label="vue3基础"><!--[--><!--[--><!--]--><!--]-->vue3基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vuex/" aria-label="vuex"><!--[--><!--[--><!--]--><!--]-->vuex<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vueRouter/" aria-label="vue router"><!--[--><!--[--><!--]--><!--]-->vue router<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/Pinia.html" aria-label="pinia"><!--[--><!--[--><!--]--><!--]-->pinia<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/html/" aria-label="html"><!--[--><!--[--><!--]--><!--]-->html<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/css3/" aria-label="图解css3"><!--[--><!--[--><!--]--><!--]-->图解css3<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/css3plus/" aria-label="css进阶"><!--[--><!--[--><!--]--><!--]-->css进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/scss/" aria-label="scss"><!--[--><!--[--><!--]--><!--]-->scss<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/browser/browser.html" aria-label="浏览器"><!--[--><!--[--><!--]--><!--]-->浏览器<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/network/webNetwork.html" aria-label="网络通信"><!--[--><!--[--><!--]--><!--]-->网络通信<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Linux"><span class="title">Linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Linux"><span class="title">Linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/linuxNote/gitUseNote.html" aria-label="git使用笔记"><!--[--><!--[--><!--]--><!--]-->git使用笔记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/linuxNote/UbuntuUsingNode.html" aria-label="linux使用记录"><!--[--><!--[--><!--]--><!--]-->linux使用记录<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="开发构建工具"><span class="title">开发构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="开发构建工具"><span class="title">开发构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/devToolsNote/npm-note.html" aria-label="npm"><!--[--><!--[--><!--]--><!--]-->npm<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/webpack/webpackNote.html" aria-label="webpack基础"><!--[--><!--[--><!--]--><!--]-->webpack基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/webpack/webpack5Note.html" aria-label="webpack5"><!--[--><!--[--><!--]--><!--]-->webpack5<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/micro-app/qiankun.html" aria-label="qiankun"><!--[--><!--[--><!--]--><!--]-->qiankun<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/tsClassicTop10SortAlgorithm.html" aria-label="排序算法"><!--[--><!--[--><!--]--><!--]-->排序算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/tsSword4Offer.html" aria-label="剑指offer"><!--[--><!--[--><!--]--><!--]-->剑指offer<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/common.html" aria-label="常见算法"><!--[--><!--[--><!--]--><!--]-->常见算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/10sortedAlgorithm.html" aria-label="排序算法python"><!--[--><!--[--><!--]--><!--]-->排序算法python<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/python_sword_for_offer.html" aria-label="剑指offer-python"><!--[--><!--[--><!--]--><!--]-->剑指offer-python<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/labuladongNote.html" aria-label="labuladong算法"><!--[--><!--[--><!--]--><!--]-->labuladong算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/vitotu" aria-label="github主页" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->github主页<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaScript"><span class="title">JavaScript</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaScript"><span class="title">JavaScript</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/jsBase.html" aria-label="js基础"><!--[--><!--[--><!--]--><!--]-->js基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/es6_/" aria-label="es6+基础"><!--[--><!--[--><!--]--><!--]-->es6+基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/js/jsPlus.html" aria-label="js进阶"><!--[--><!--[--><!--]--><!--]-->js进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/jsHand.html" aria-label="js手写系列"><!--[--><!--[--><!--]--><!--]-->js手写系列<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/js/typescript/" aria-label="typescript"><!--[--><!--[--><!--]--><!--]-->typescript<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>js读书笔记</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/js/jsAsync/" aria-label="js异步编程"><!--[--><!--[--><!--]--><!--]-->js异步编程<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/js/jsDeep/" aria-label="你不知道的js系列"><!--[--><!--[--><!--]--><!--]-->你不知道的js系列<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue2base.html" aria-label="vue2基础"><!--[--><!--[--><!--]--><!--]-->vue2基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue2plus/" aria-label="vue2进阶"><!--[--><!--[--><!--]--><!--]-->vue2进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vue3base/" aria-label="vue3基础"><!--[--><!--[--><!--]--><!--]-->vue3基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vuex/" aria-label="vuex"><!--[--><!--[--><!--]--><!--]-->vuex<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/vueRouter/" aria-label="vue router"><!--[--><!--[--><!--]--><!--]-->vue router<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/vue/Pinia.html" aria-label="pinia"><!--[--><!--[--><!--]--><!--]-->pinia<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/html/" aria-label="html"><!--[--><!--[--><!--]--><!--]-->html<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/css3/" aria-label="图解css3"><!--[--><!--[--><!--]--><!--]-->图解css3<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/css3plus/" aria-label="css进阶"><!--[--><!--[--><!--]--><!--]-->css进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/css/scss/" aria-label="scss"><!--[--><!--[--><!--]--><!--]-->scss<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/browser/browser.html" aria-label="浏览器"><!--[--><!--[--><!--]--><!--]-->浏览器<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/network/webNetwork.html" aria-label="网络通信"><!--[--><!--[--><!--]--><!--]-->网络通信<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Linux"><span class="title">Linux</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Linux"><span class="title">Linux</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/linuxNote/gitUseNote.html" aria-label="git使用笔记"><!--[--><!--[--><!--]--><!--]-->git使用笔记<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/linuxNote/UbuntuUsingNode.html" aria-label="linux使用记录"><!--[--><!--[--><!--]--><!--]-->linux使用记录<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="开发构建工具"><span class="title">开发构建工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="开发构建工具"><span class="title">开发构建工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/devToolsNote/npm-note.html" aria-label="npm"><!--[--><!--[--><!--]--><!--]-->npm<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/webpack/webpackNote.html" aria-label="webpack基础"><!--[--><!--[--><!--]--><!--]-->webpack基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/webpack/webpack5Note.html" aria-label="webpack5"><!--[--><!--[--><!--]--><!--]-->webpack5<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/micro-app/qiankun.html" aria-label="qiankun"><!--[--><!--[--><!--]--><!--]-->qiankun<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/tsClassicTop10SortAlgorithm.html" aria-label="排序算法"><!--[--><!--[--><!--]--><!--]-->排序算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/tsSword4Offer.html" aria-label="剑指offer"><!--[--><!--[--><!--]--><!--]-->剑指offer<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/common.html" aria-label="常见算法"><!--[--><!--[--><!--]--><!--]-->常见算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/10sortedAlgorithm.html" aria-label="排序算法python"><!--[--><!--[--><!--]--><!--]-->排序算法python<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/python_sword_for_offer.html" aria-label="剑指offer-python"><!--[--><!--[--><!--]--><!--]-->剑指offer-python<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/algorithm/labuladongNote.html" aria-label="labuladong算法"><!--[--><!--[--><!--]--><!--]-->labuladong算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/vitotu" aria-label="github主页" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->github主页<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">js进阶知识梳理 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="js进阶知识梳理" tabindex="-1"><a class="header-anchor" href="#js进阶知识梳理"><span>js进阶知识梳理</span></a></h1><p>本笔记中主要整理一些js的进阶知识以及一些相似的知识点整理</p><h2 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型"><span>数据类型</span></a></h2><p>null,undefined,string,Number,boolean;5种基本类型,es6引入了bigint,Symbol两种基本类型<br> Object引用类型,<br> 总计8种数据类型</p><h3 id="数据类型判断与比较" tabindex="-1"><a class="header-anchor" href="#数据类型判断与比较"><span>数据类型判断与比较</span></a></h3><p>判断数据类型的方法有</p><ul><li>typeof 直接进行类型判断</li><li>instanceof 借用__proto__属性(原型链)关系判断实例是否与函数的prototype相等</li><li>Object.prototype.toString.call() 借用原型链进行判断</li><li>constructor 该属性返回实例的构造函数</li><li>=== 严格比较判断</li></ul><h4 id="区别" tabindex="-1"><a class="header-anchor" href="#区别"><span>区别</span></a></h4><p>typeof能正确输出变量所属基本类型(null除外)和引用类型中的function，对null和其他引用类型输出object</p><p>instanceof运算符用于检测构造函数的prototype属性是否出现在某个实例对象的原型链上,也就是顺着原型链去找，直到找到相同的原型对象，对基本类型判断都返回false</p><p>constructor 则是顺着constructor属性去找</p><p>区别：</p><ol><li>typeof会返回一个变量的基本类型(以字符串的形式表示)，instanceof返回的是一个布尔值</li><li>instanceof 可以准确地判断复杂引用数据类型，但是不能正确判断基本数据类型</li><li>typeof主要用于判断基本类型(null除外),<code>typeof null</code>输出object是js的一个遗留bug</li></ol><p>通用的判断方式是Object.prototype.toString.call()方法，该方法统一返回字符串格式<code>&#39;[object Xxx]&#39;</code>，<br> 该方法隐含对基本类型转换为包装类型然后调用toString()方法</p><p>constructor通常用于示例对象访问其构造函数,相比于instanceof可用于判断基本类型<br> null和undefined没有constructor属性，不能使用此方法进行判断.另外基本类型的constructor属性只读，但引用类型的则可以被修改</p><p><code>===</code>严格相等判断符，通常用于判断变量是否为null或undefined，变量被声明但未初始化(赋值)时为undefined,<br> 若定义一个变量将来要引用一个对象，通常将其初始化为null，在回收变量时也通常将其赋值为null</p><p>以下是一些示例</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#39;[object Symbol]&#39;  </span></span>
<span class="line"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// [object Null]  </span></span>
<span class="line"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// [object Number]  </span></span>
<span class="line"><span class="token keyword">typeof</span> <span class="token number">NaN</span> <span class="token comment">// number  </span></span>
<span class="line"><span class="token keyword">null</span> <span class="token keyword">instanceof</span> <span class="token class-name">null</span> <span class="token comment">// 报错  </span></span>
<span class="line"><span class="token keyword">null</span> <span class="token keyword">instanceof</span> <span class="token class-name">object</span> <span class="token comment">// false  </span></span>
<span class="line"><span class="token number">1.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span>constructor <span class="token comment">// 报错 数字后接&#39;.&#39;会被优先解析为小数点  </span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span>constructor <span class="token operator">===</span> Number <span class="token comment">// true  </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="变量与数据类型" tabindex="-1"><a class="header-anchor" href="#变量与数据类型"><span>变量与数据类型</span></a></h3><p>严格区别变量类型与数据类型?</p><ul><li>数据的类型 <ul><li>基本类型</li><li>对象类型</li></ul></li><li>变量的类型(变量内存值的类型) <ul><li>基本类型: 保存就是基本类型的数据</li><li>引用类型: 保存的是地址值</li></ul></li></ul><h4 id="的区别" tabindex="-1"><a class="header-anchor" href="#的区别"><span><code>===</code>, <code>==</code>的区别</span></a></h4><ul><li><code>==</code>:比较时会进行必要的类型转换，转换为同一数据类型再进行比较</li></ul><p>null与undefined相等,NaN不与任何值相等;<br> 字符串与数值比较,会将字符串转为数值再进行比较;<br> 任意值为true时转为1,false转为0再进行比较;<br> 对象与基本数据比较时，会调用对象的valueof或toString方法转换为基础类型进行比较<br> Number,String,Boolean类型出现在等号两边时,只要类型不同,都转换为Number类型再比较;</p><ul><li><code>===</code>不会进行类型转换</li></ul><p>NaN不与任何值相等(包括自身)；<br> 对象类型，两个值都引用同一个对象才相等；<br> null和undefined与自身相等，但相互不相等</p><ul><li>另外相等判断时NaN使用isNaN()判断，<br> ES6中提供了Object.is(obj1,obj2)新的判断方法，该方法与<code>===</code>类似,但额外兼容了NaN,并且认为-0和+0不相等<br> 三种比较方法在进行引用类型之间的比较时，需引用相同的对象时才相等，如：<code>{a:&#39;a&#39;} == {a:&#39;a&#39;}</code>输出false<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Equality_comparisons_and_sameness" target="_blank" rel="noopener noreferrer">参考文档</a></li></ul><h3 id="包装类型" tabindex="-1"><a class="header-anchor" href="#包装类型"><span>包装类型</span></a></h3><p>对于基本类型，严格来说是没有任何方法，<br> 如语句<code>&#39;abc&#39;.substring(1,2)</code>表达式应该报错而不是输出b，但实际上存在类似下列过程</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line">temp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  </span>
<span class="line">temp <span class="token operator">=</span> <span class="token keyword">null</span>  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个过程中使用了string类型对应的包装类String，<br> es6之前只有String(),Number(),Boolean()可以通过new创建包装类，<br> es6中新增的BigInt，Symbol不可通过new操作符创建包装类<br> ecma官方建议应当尽量避免显式使用包装类</p><h3 id="隐式类型转换" tabindex="-1"><a class="header-anchor" href="#隐式类型转换"><span>隐式类型转换</span></a></h3><h4 id="数学运算符中的类型转换" tabindex="-1"><a class="header-anchor" href="#数学运算符中的类型转换"><span>数学运算符中的类型转换</span></a></h4><ul><li>减、乘、除:会将非Number类型转换为Number类型，对于对象类型隐含‘拆箱’操作再转换为Number类型</li><li>加，当一侧有String时，将另一侧转换为字符串进行拼接；在此基础上，当一侧为Number，另一侧为其他基本类型，则将基本类型转换为Number类型，另一侧为引用类型时，则都转换为String进行拼接</li></ul><h4 id="逻辑语句中的类型转换" tabindex="-1"><a class="header-anchor" href="#逻辑语句中的类型转换"><span>逻辑语句中的类型转换</span></a></h4><ul><li>单个变量逻辑判断时if,while,!等直接将变量转换为Boolean,类似与Boolean()方法，只有null,undefined,&#39;&#39;,NaN,0,false为false，其他为true，如{}, []等</li><li><code>==</code>,NaN与任何类型比较都为false;</li><li>Boolean与任何类型比较都转换为Number;</li><li><code>String==Number</code>,String转换为Number;</li><li><code>null==undefined</code>为true,与其他非值(自身除外)比较都为false;</li><li>基本类型和引用类型比较时会遵循先valueof后tostring的模式转换为基本类型,再比较</li></ul><h2 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h2><p>函数有四种方式：作为构造器new调用；作为对象方法调用；正常调用(在当前词法作用域中调用)；间接调用(通过call、apply、bind等方式)</p><h3 id="this指向问题" tabindex="-1"><a class="header-anchor" href="#this指向问题"><span>this指向问题</span></a></h3><p>函数中的this是在运行时确定的，this有4中绑定方式</p><ol><li>默认绑定<br> 函数独立调用时，默认调用方为全局对象，即window对象；严格模式下为undefined；立即调用函数和函数中被直接调用的函数也是独立调用的一种形式</li><li>隐式绑定<br> 谁调用该函数，this就执行该对象(当前执行的上下文)</li><li>显式绑定<br> 使用call、apply、bind方法，这些方法绑定仅第一次有效</li><li>new绑定<br> 使用new实例化时，this指向实例。绑定优先级为4&gt;3&gt;2&gt;1</li></ol><p>箭头函数没有自己的this,因此在箭头函数中引用this是引用其父级作用域的this</p><h3 id="apply、bind、call方法辨析" tabindex="-1"><a class="header-anchor" href="#apply、bind、call方法辨析"><span>apply、bind、call方法辨析</span></a></h3><p>此三者都可以改变this指向，其中bind变更this后返回新函数，而apply,call直接运行函数</p><ul><li><code>fun.apply(obj, args)</code>：obj为this的指向，当obj为null或undefined时，默认指向window。改变fun内部this指向后立即执行一次，指向修改仅当次有效</li><li><code>fun.call(obj, ...args)</code>：apply接收参数为数组，call接收多个单独的参数值，其他性质与apply相同</li><li><code>fun.bind(obj, ...args)</code>：传参与call方法类似，但不会执行fun，而是返回一个新函数，并改变新函数的this指向，可传入一部分args参数，新函数调用时也可继续传入剩下的参数 <ul><li>bind是硬绑定，返回的新函数会使用obj去调用原始函数，并传递其他参数，绑定后不能通过显式或硬绑定的方式修改this，只能通过new改变</li><li>softBind会对指定函数进行封装，调用时首先检查this，如果this为全局对象或undefined则会使用obj调用原函数，否则不会修改this，即softBind绑定可多次修改，最后一次有效。</li></ul></li></ul><p>实现简易的call、apply、bind、softBind：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// call</span></span>
<span class="line"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx <span class="token operator">=</span> globalThis</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从arguments收集参数更具兼容性</span></span>
<span class="line">  <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 将调用myCall的函数fun绑定到ctx[key]属性上</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用ctx调用fun方法，此次调用fun中this变为ctx</span></span>
<span class="line">  <span class="token keyword">delete</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 删除fun属性</span></span>
<span class="line">  <span class="token keyword">return</span> res<span class="token punctuation">;</span> <span class="token comment">// 返回运行结果</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// apply 实现机制与call类似，不再详细注释</span></span>
<span class="line"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx <span class="token operator">=</span> globalThis</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">delete</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> res<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// bind</span></span>
<span class="line"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx <span class="token operator">=</span> globalThis</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 将调用myBind的函数暂存为fn</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">bound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">bound</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当bound的调用方是fn的实例时，则使用该实例调用，对应new操作符，改变绑定this的情况,同时该判断条件使后续的多次绑定无效</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  bound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> fn<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> bound<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// es6的极简实现bind</span></span>
<span class="line"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">fakeBind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// softBind</span></span>
<span class="line"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mySoftBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx <span class="token operator">=</span> globalThis</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">bound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span> <span class="token operator">||</span> <span class="token keyword">this</span> <span class="token operator">===</span> globalThis<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅调用方为undefined/null或全局对象时，使用绑定的值</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  bound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> fn<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> bound<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="箭头函数" tabindex="-1"><a class="header-anchor" href="#箭头函数"><span>箭头函数</span></a></h3><ul><li>箭头函数无this</li><li>不可当做构造函数使用new命令</li><li>没有arguments对象</li><li>不可使用yield命令 在其中使用this时指向的时定义是所在作用域</li></ul><h3 id="变量提升和函数提升" tabindex="-1"><a class="header-anchor" href="#变量提升和函数提升"><span>变量提升和函数提升</span></a></h3><p>使用function定义函数，和使用var定义变量时存在变量提升和函数提升，变量提升先预处理变量后处理函数</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span> <span class="token comment">// function 无论变量和函数的顺序，变量提升先处理，函数提升后处理，因此函数覆盖同名变量  </span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b<span class="token punctuation">)</span> <span class="token comment">// function  </span></span>
<span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  </span>
<span class="line"><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  </span>
<span class="line"><span class="token keyword">var</span> b<span class="token punctuation">;</span>  </span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// 提升后a被初始化，因此覆盖了a函数  </span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// undefined 变量提升但不会先赋值  </span></span>
<span class="line"><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  </span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment">// [Function: d] 函数提升则可立即调用  </span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="闭包" tabindex="-1"><a class="header-anchor" href="#闭包"><span>闭包</span></a></h3><p>当函数可以记住并访问其所在的词法作用域，即时函数是在当前词法作用域之外执行，这就形成了闭包</p><p>闭包应用无处不在，模块化和定时器、ajax、事件监听等用到回调函数的地方 TODO：</p><h3 id="节流-throttle-与防抖-debounce" tabindex="-1"><a class="header-anchor" href="#节流-throttle-与防抖-debounce"><span>节流(throttle)与防抖(debounce)</span></a></h3><p>主要用于优化高频执行的js</p><ol><li>防抖(debounce)：触发事件在n秒内只能执行一次，若n秒内重新触发，则重置计时器，多次触发只会执行最后一次；无限延后执行<br> 防抖常用于输入框ajax，判断scroll是否滑到底部，防止表单多次提交(类比游戏中的施法读条前摇)</li><li>节流(throttle)：连续触发事件，但n秒内只执行一次，节流会稀释函数的执行频率<br> 节流常用于DOM元素拖拽,resize,scroll等事件(类比游戏中的技能cd)</li></ol><p>两者最大的区别在于，指定时间内，防抖为重复触发无限延后执行，节流为重复触发仅执行一次，不重置计时器，不会无限延后<br> 简而言之：<br> 相同点：n秒内只执行一次<br> 不同点：n秒内重复触发，防抖无限延后执行，节流只执行一次</p><p>带防抖与节流功能的第三方库：underscore,lodash,Ramda(仅用防抖与节流时不推荐引用)</p><ul><li>手写防抖节流实现:</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@description</span>: 防抖wrap函数</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Function<span class="token punctuation">}</span></span> <span class="token parameter">func</span> 传入要包装的函数</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">wait</span> 防抖间隔</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>boolean<span class="token punctuation">}</span></span> <span class="token parameter">immediate</span> 可选项是否立即执行</span>
<span class="line"> * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword">undefined</span><span class="token punctuation">}</span></span></span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> immediate<span class="token operator">=</span><span class="token boolean">false</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>immediate<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 用于首次/立即执行</span></span>
<span class="line">      <span class="token keyword">let</span> callNow <span class="token operator">=</span> <span class="token operator">!</span>timer<span class="token punctuation">;</span></span>
<span class="line">      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>callNow<span class="token punctuation">)</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 延时执行</span></span>
<span class="line">      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@description</span>: 防抖wrap异步支持版本，也支持同步任务</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 参数与同步版本类似</span>
<span class="line"> * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">}</span></span> 返回的执行函数将返回包装好的promise对象，调用then将传入异步函数执行结果</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">debounceAsync</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 为添加对异步请求接口的支持返回promise对象，此处也可直接设置定时器，下同</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// res接收promise对象会等待promise对象状态翻转，再返回promise对象的结果</span></span>
<span class="line">      <span class="token function">res</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> isImmediate <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">      flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 执行代码，并加锁</span></span>
<span class="line">      isImmediate <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 立即执行时机</span></span>
<span class="line">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">!</span>isImmediate <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 延迟执行时机</span></span>
<span class="line">        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 在延迟执行后释放执行锁</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@description</span>: 节流wrap函数异步版本，返回值与防抖类似,节流也可使用时间戳与间隔时间对比实现</span>
<span class="line"> * 节流也有立即执行和非立即执行的版本，实现思路与防抖类似</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">throttleAsync</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> result<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 单独拎出executor即为同步执行的版本</span></span>
<span class="line">        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">res</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span> result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://blog.csdn.net/Polaris_tl/article/details/99300458" target="_blank" rel="noopener noreferrer">参考文档</a></p><h2 id="js运行机制" tabindex="-1"><a class="header-anchor" href="#js运行机制"><span>js运行机制</span></a></h2><p>js执行是会将对象放在堆(heap)中，将基础变量以及对象的引用(指针)放在栈(stack)中;<br> js还维护了一个执行栈用于存放执行过程数据, 与数据栈意义不同</p><h3 id="浏览器" tabindex="-1"><a class="header-anchor" href="#浏览器"><span>浏览器</span></a></h3><p>js重要的运行环境之一浏览器，可能是多进程或单进程的(现代浏览器大多是多进程的)；但浏览器都是多线程的。js是单线程的；<br> 不同的浏览器有不同的内核：<code>chrome, Safari:webkit, firefox:Gecko, IE:Trident等</code>，这些内核提供了html，css文档解析，dom/css模块在内存中的管理，布局和渲染以及js解释器等模块，chrome和nodejs中的js解释器为v8</p><h3 id="事件循环模型" tabindex="-1"><a class="header-anchor" href="#事件循环模型"><span>事件循环模型</span></a></h3><p><img src="/assets/eventLoop-CaKfvQHA.png" alt="avatar"><br> 简单理解：<br> 先运行同步代码，绑定DOM事件监听，定时器，发送ajax请求等。其中将异步函数交给事件管理模块，当事件触发时，管理器将回调函数添加到任务队列，主线程不断从任务队列中取出任务执行。</p><p>更进一步的：<br> 任务队列又分为宏任务(macro task)和微任务(micro task)，其中由Promise和MutationObserver传入的回调函数属于微任务，而setTimeout和setInterval属于宏任务；<br> js的初始化代码执行完同步代码后会优先处理微任务队列中的所有事件，然后是宏任务队列。<br> 示例代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   </span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  </span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line">  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  </span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span>  </span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token comment">// 输出为:1 3 4 6 5 2  </span></span>
<span class="line"><span class="token comment">// new Promise时传入的匿名函数是同步代码,then中的为回调微任务  </span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 另外后面的手写promise实现章节中可以看出，</span>
<span class="line"> * 使用Promise.resolve方法若参数为Promise对象</span>
<span class="line"> * 则会在内部调用一次then方法，额外产生一次微任务,</span>
<span class="line"> * 同理在then中传入的函数若返回为Promise对象，也会额外调用一次Promise方法产生额外的微任务；</span>
<span class="line"> * 在async/await的手写实现中，对于Promise对象使用await/yield也相当与一次then方法</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">&quot;p3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: p1、p3、p2</span></span>
<span class="line"><span class="token comment">// 在同步代码运行完成后，p3,p2都额外提交了一个空的微任务，因此p1优先被打印</span></span>
<span class="line"></span>
<span class="line">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 额外产生了1个空的微任务，但具体底层实现时实际产生了两个微任务，因此延后到了3之后打印</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 输出为 0,1,2,3,4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="事件循环与渲染、帧动画、空闲回调的关系" tabindex="-1"><a class="header-anchor" href="#事件循环与渲染、帧动画、空闲回调的关系"><span>事件循环与渲染、帧动画、空闲回调的关系</span></a></h3><p>空闲回调requestIdleCallback维护一个队列，在浏览器空闲时执行<br> 帧动画requestAnimationFrame在每次重新渲染前调用<br> 浏览器的渲染和代码执行使用了不同的引擎，每轮事件循环不一定伴随着渲染，而微任务队列和宏任务队列也都不止一个<br> 微任务执行完成后会判断rendering opportunity，若需要渲染则依次执行以下方法resize、scroll、requestAnimationFrame回调、IntersectionObserver回调、执行渲染，判断宏任务和微任务队列是否为空，为空则执行requestIdleCallback回调。 详细参考文档： <a href="https://juejin.cn/post/6844904165462769678" target="_blank" rel="noopener noreferrer">参考文档</a></p><h3 id="浏览器的关键渲染路径" tabindex="-1"><a class="header-anchor" href="#浏览器的关键渲染路径"><span>浏览器的关键渲染路径</span></a></h3><ol><li>生成DOM</li></ol><p><img src="/assets/html-parse-Cn6ZNvZd.png" alt="avatar"></p><ol start="2"><li>解析css文件，生成cssom</li></ol><p><img src="/assets/cssom-AxT5c-0L.png" alt="avatar"></p><ol start="3"><li>DOM与cssom一起生成Render Tree</li></ol><p><img src="/assets/render-tree-DMi79IGJ.png" alt="avatar"></p><ol start="4"><li>Layout 计算每一个元素在设备视口内的确切位置和大小</li></ol><p><img src="/assets/layout-DFAeK3bi.png" alt="avatar"></p><ol start="5"><li>Paint 将渲染树中的每个节点转换成屏幕上的实际像素，这一步通常称为绘制或栅格化</li></ol><p><img src="/assets/paint-B99QFyBN.png" alt="avatar"></p><p><a href="https://blog.windstone.cc/browser-env/browser/how-browsers-work.html#_1-%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5" target="_blank" rel="noopener noreferrer">参考文档</a></p><h3 id="重排与重绘" tabindex="-1"><a class="header-anchor" href="#重排与重绘"><span>重排与重绘</span></a></h3><p>重排和重绘是关键渲染路径中的两步:</p><ul><li>重排(Reflow)：元素的位置发生变动时发生重排，也叫回流。此时在关键渲染路径中的 Layout 阶段，计算每一个元素在设备视口内的确切位置和大小。当一个元素位置发生变化时，其父元素及其后边的元素位置都可能发生变化，代价极高</li><li>重绘(Repaint): 元素的样式发生变动，但是位置没有改变。此时在关键渲染路径中的 Paint 阶段，将渲染树中的每个节点转换成屏幕上的实际像素，这一步通常称为绘制或栅格化</li></ul><p>另外，重排必定会造成重绘。以下是避免过多重排重绘的方法</p><ol><li>使用 DocumentFragment 进行 DOM 操作，不过现在原生操作很少也基本上用不到</li><li>CSS 样式尽量批量修改</li><li>避免使用 table 布局</li><li>为元素提前设置好高宽，不因多次渲染改变位置</li></ol><p><a href="https://juejin.cn/post/6844903476506394638" target="_blank" rel="noopener noreferrer">更深的渲染原理</a></p><h3 id="v8垃圾回收机制" tabindex="-1"><a class="header-anchor" href="#v8垃圾回收机制"><span>v8垃圾回收机制</span></a></h3><p>垃圾回收主要分为引用计数法和标记法(是否可达)<br> 引用计数无法解决循环引用问题；标记法通过根对象层层遍历，标记可访问到对象</p><p>v8中js的基本数据类型被保存在栈内存中，而引用数据类型在栈中保存着指针，指向堆内存中的对象，栈内存的数据是由操作系统来负责分配和回收，堆内存中由v8进行管理</p><p>分代回收：v8将堆内存分为两个区域</p><ul><li>存活周期短(经过一次垃圾回收就被销毁的)的为新生代，内存容量通常较小，使用副垃圾回收器和Scavenge算法进行垃圾回收。</li></ul><div class="hint-container tip"><p class="hint-container-title">更进一步的</p><p>新生代还进一步细分为nursery子代和intermediate子代两个区域，对象第一次分配内存时会分到nursery子代，若经过一次垃圾回收该对象还存在则移入intermediate子代，若再经过一次垃圾回收该对象还在新生代则晋升到老生代中</p><p>任何声明的对象都会被优先分配到新生代中，Scavenge算法将新生代堆分为from-space和to-space，执行步骤如下：</p><ol><li>标记活动对象和非活动对象</li><li>from-space中标记存活的对象复制到to-space中并进行整理排序</li><li>将from-space中的非活动对象内存释放</li><li>互换from-space和to-space</li></ol></div><ul><li>存活周期长(经过多次垃圾回收依然存活的)的为老生代，使用主垃圾回收器 + Mark-Sweep &amp;&amp; Mark-Compact算法。新生代中Scavenge速度快，但内存空间消耗大，效率低，老生代空间大，使用Mark-Sweep进行标记和清理 <ol><li>标记阶段：对老生代对象进行第一次扫描，对活动对象进行标记</li><li>清理阶段：对老生代对象进行第二次扫描，清除未标记的对象，即非活动对象</li><li>整理阶段(Mark-Compact中特有的)：尽量保持空闲内存连续</li></ol></li></ul><p><img src="/assets/garbageCollection-C2PUe8Ya.png" alt="garbageCollection.png"></p><ul><li>垃圾回收的性能优化： <ul><li>全停顿 垃圾回收也需要js引擎执行，且垃圾回收优先于普通代码的执行，此时会造成普通代码的停顿</li><li>Orinoco优化：orinoco为V8的垃圾回收器的项目代号 <ul><li>增量标记(标记与js代码执行交替进行)</li><li>惰性清理(需要写屏障，类似java中的锁来保证安全同步)</li><li>并发</li><li>并行</li></ul></li></ul></li></ul><p><a href="https://www.teqng.com/2021/09/01/13%E5%BC%A0%E5%9B%BE%EF%BC%8120%E5%88%86%E9%92%9F%EF%BC%81%E8%AE%A4%E8%AF%86v8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener noreferrer">参考文档</a></p><h2 id="面向对象" tabindex="-1"><a class="header-anchor" href="#面向对象"><span>面向对象</span></a></h2><h3 id="原型与原型链" tabindex="-1"><a class="header-anchor" href="#原型与原型链"><span>原型与原型链</span></a></h3><ul><li>函数类型(可以理解为工厂)独有prototype显式原型属性, 指向用于创建对应实例的原型对象(可以理解为设计图)；</li><li>原型对象中有一个属性constructor, 它指向函数对象；</li><li>实例对象(工厂照设计图生产的产品)和函数(函数本身也是对象)都有__proto__属性和constructor属性，分别指向其构造函数的原型和构造函数</li></ul><p><img src="/assets/prototype-rWnn0nll.svg" alt="prototype.svg"><br> 如图为Foo函数、实例、Function、Object的原型对应关系：<br> 矩形表示实例对象/原型对象，椭圆表示函数对象<br> 红色箭头即为原型链，Function函数对象的constructor指向自己，prototype和__proto__属性指向相同的原型对象<br> Object的原型对象的原型对象指向null；引用对象的constructor可以被更改，而基本类型的只读</p><h3 id="new操作符" tabindex="-1"><a class="header-anchor" href="#new操作符"><span>new操作符</span></a></h3><p>new操作符用于创建一个给定构造函数的对象实例，其执行过程简单理解为：</p><ol><li>创建一个空对象obj</li><li>将obj的<code>[[prototype]]</code>属性指向构造函数construct的原型,即<code>obj.__proto__ = construct.prototype</code></li><li>将construct的this绑定到obj上，执行construct为obj添加属性和方法</li><li>construct若无返回值，则默认返回obj，否则返回指定的返回值</li></ol><p>实现简单的new操作符:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">myNew</span><span class="token punctuation">(</span><span class="token parameter">construct<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 1. 创建一个空对象</span></span>
<span class="line">    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> construct<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// 2. 将obj的[[prototype]]属性指向构造函数的原型对象</span></span>
<span class="line">    obj<span class="token punctuation">.</span>constructor <span class="token operator">=</span> construct<span class="token punctuation">;</span> <span class="token comment">// 绑定构造函数属性</span></span>
<span class="line">    <span class="token function">construct</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.将construct执行的上下文this绑定到obj上，并执行</span></span>
<span class="line">    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>  <span class="token comment">//4. 返回新创建的对象</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用的例子：</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> person1 <span class="token operator">=</span> <span class="token function">myNew</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> <span class="token string">&#39;Tom&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span>  <span class="token comment">// Person {name: &quot;Tom&quot;, age: 20}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="继承" tabindex="-1"><a class="header-anchor" href="#继承"><span>继承</span></a></h3><p>es6中多使用寄生组合式继承模式<br> 详细<a class="route-link" href="/js/jsBase.html#%E7%BB%A7%E6%89%BF">参见</a></p><h2 id="前端性能与优化" tabindex="-1"><a class="header-anchor" href="#前端性能与优化"><span>前端性能与优化</span></a></h2><p>前端性能优化主要分为两方面：</p><ul><li>网络性能优化 <ul><li>优化资源大小：压缩、裁剪、懒加载、预加载等</li><li>缓存控制：善用http缓存机制，强缓存、协商缓存等</li><li>网络请求控制：减少请求，连接复用，data url等</li><li>优化js代码：tree shaking，代码压缩，懒加载，code split等</li><li>优化首次渲染路径：媒体查询避免不必要的css，js标签async、defer属性避免html阻塞</li></ul></li><li>数据处理(渲染)性能优化 <ul><li>减少DOM查询</li><li>使用requestAnimationFrame代替setTimeout和setInterval来更新视图，减少卡顿</li><li>防抖与节流减少函数执行频次</li><li>多线程web worker</li><li>复杂度更低的class风格css选择器，flex代替float</li></ul></li></ul><h3 id="性能指标" tabindex="-1"><a class="header-anchor" href="#性能指标"><span>性能指标</span></a></h3><p>文档加载相关指标 <img src="/assets/timestamp-diagram-B3GQzATK.svg" alt="timestamp-diagram"></p><ul><li>Time to First Byte（TTFB）:浏览器从请求页面开始到接收第一字节的时间，这个时间段内包括 DNS 查找、TCP 连接和 SSL 连接。</li><li>DomContentLoaded(DCL): DOMContentLoaded 事件触发的时间, html 文档完全加载解析后(无需等待样式表、图像、iframe等)</li><li>Load（L）：onLoad 事件触发的时间。页面所有资源都加载完毕后（比如图片，CSS），onLoad 事件才被触发。</li></ul><p>内容呈现相关</p><ul><li>First Paint（FP）：从开始加载到浏览器首次绘制像素到屏幕上的时间，不包括默认的背景绘制，但包括非默认的背景绘制。</li><li>First Contentful Paint（FCP）：浏览器首次绘制来自 DOM 的内容的时间，内容必须是文本、图片（包含背景图）、非白色的 canvas 或 SVG，也包括带有正在加载中的 Web 字体的文本(使用网络字体时设置<code>font-display: swap;</code>可临时使用系统字体，加载完毕后使用网络字体)。</li><li>First Meaningful Paint（FMP）：页面的主要内容绘制到屏幕上的时间，采用布局数量最大并且 Web 字体已加载 的时刻作为主要内容绘制的近似时间</li><li>Largest Contentful Paint（LCP）：可视区域中最大的内容元素呈现到屏幕上的时间</li><li>Speed Index（SI）：页面可视区域中内容的填充速度的指标，可以通过计算页面可见区域内容显示的平均时间来衡量。</li><li>First Screen Paint（FSP）:页面从开始加载到首屏内容全部绘制完成的时间</li></ul><p>交互响应相关</p><ul><li>Time to Interactive（TTI）:网页第一次完全达到可交互状态的时间点(可持续交互)</li><li>First CPU Idle（FCI）:页面第一次可以响应用户输入的时间</li><li>First Input Delay（FID）：用户第一次与页面交互（例如单击链接、点击按钮等）到浏览器实际能够响应该交互的时间。</li><li>Frames Per Second（FPS）：每秒可以重新绘制的帧数</li></ul><blockquote><p>其中用户体验的核心指标:</p><blockquote><p>白屏时间为FP或FCP 也可使用window.performance.timing.domLoading - window.performance.timing.navigationStart来计算<br> 首屏时间FSP,该指标还没有同一计算标准,通常采用时间window.performance.timing.domInteractive - window.performance.timing.navigationStart来计算<br> 可交互时间FCI<br> 可流畅交互时间</p></blockquote></blockquote><p>在chrome中f12开发者工具中的Lighthouse可获取上述部分指标及网页性能报告，而performance选项则用于收集webapp运行时的性能(与加载性能区别开)<br><a href="https://serverless-action.com/fontend/fe-optimization/%E4%BB%8E%E8%BE%93%E5%85%A5%20URL%20%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%EF%BC%8C%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F.html#%E5%8F%82%E8%80%83" target="_blank" rel="noopener noreferrer">参考文档</a><br> 如：<br> 白屏时间: window.performance.timing.domLoading - window.performance.timing.navigationStart<br> 首屏时间: window.performance.timing.domInteractive - window.performance.timing.navigationStart</p><h3 id="首屏时间优化" tabindex="-1"><a class="header-anchor" href="#首屏时间优化"><span>首屏时间优化</span></a></h3><ol><li>对于pv量(page view)比较高的页面，比如 b 站等流量图也比较大的，采用 ssr<br> 采用 ssr 如何优化性能 <ul><li>性能瓶颈在于 react-dom render/hydrate 和 server 端的 renderToString</li><li>尽量减少 dom 结构， 采用流式渲染，jsonString 一个对象，而不是 literal 对象</li><li>server 去获取数据</li><li>不同情况不同分析，减少主线程阻塞时间</li><li>减少不必要的应用逻辑在服务端运行</li></ul></li><li>减少依赖和包的体积 <ul><li>利用 webpack 的 contenthash 缓存</li><li>重复依赖包处理，可以采用 pnpm</li><li>采用 code splitting，减少首次请求体积</li><li>减少第三方依赖的体积</li></ul></li><li>网络 prefetch cdn</li></ol><h2 id="异步编程" tabindex="-1"><a class="header-anchor" href="#异步编程"><span>异步编程</span></a></h2><ul><li>js中常见的异步方式： <ol><li>回调函数(如：定时器中的回调函数)；</li><li>事件监听；</li><li>发布订阅；</li><li>Promise；</li><li>生成器；</li><li>async/wait</li></ol></li></ul><h3 id="promise" tabindex="-1"><a class="header-anchor" href="#promise"><span>Promise</span></a></h3><ul><li><p>Promise是js中用来替代回调的新的异步解决方案，其本质是一个构造函数，封装异步操作获取异步操作的成功或失败的结果。</p></li><li><p>promise的状态改变只能是：pending=&gt;resolved或pending=&gt;rejected,且只能变一次。调用resolve则会将状态从当前pending改为resolved，调用reject或抛出错误则将当前状态由pending改为rejected</p></li><li><p>promise之前的回调方式的异步，在嵌套回调时存在无限嵌套的回调地狱问题，而promise通过链式调用能够避免该问题</p></li><li><p>promise可以利用then方法返回新的promise机制串联多个任务，想要结束promise链只能在回调中返回一个pending状态的promise</p></li></ul><h3 id="常见promiseapi" tabindex="-1"><a class="header-anchor" href="#常见promiseapi"><span>常见promiseApi</span></a></h3><ul><li>promise构造函数：<code>new Promise(executor){}</code><ul><li>executor执行器参数为函数，会在promise内部立即同步调用<code>(resolve, reject)=&gt; {}</code></li><li>resolve 成功时调用的函数</li><li>reject 内部失败时调用的函数</li></ul></li><li><code>Promise.prototype.then(onResolve, onReject)</code>方法,返回一个新的promise对象 <ul><li>onResolve成功时的回调</li><li>onRejected函数: 失败的回调函数</li></ul></li><li><code>Promise.prototype.catch(onReject)</code>，语法糖，相当于then(undefined,onReject)</li><li><code>Promise.resolve(value)</code>返回一个成功的promise对象,成功的数据为value或promise对象</li><li><code>Promise.reject(reason)</code>返回一个失败的 promise 对象</li><li><code>Promise.all(promises)</code>返回一个新的 promise, 只有所有的promise都成功才成功,成功数据为promises成功数据组成的数组, 只要有一个失败了就直接失败，失败信息为失败的那个promise信息</li><li><code>Promise.race(promises)</code>返回promises数组中最先返回的那个promise的结果状态</li></ul><h3 id="手写promise实现" tabindex="-1"><a class="header-anchor" href="#手写promise实现"><span>手写promise实现</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span></span>
<span class="line">  status <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span> <span class="token comment">// promise状态</span></span>
<span class="line">  result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 返回结果</span></span>
<span class="line">  callback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用于异步任务中缓存回调函数</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 构造函数传入executor执行器</span></span>
<span class="line">    <span class="token keyword">const</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 保存对象的this便于在回调函数中使用</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 成功时的状态翻转函数</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>_self<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 保证状态只能从pending翻转</span></span>
<span class="line">      _self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 翻转状态</span></span>
<span class="line">      _self<span class="token punctuation">.</span>result <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token comment">// 保存回调执行结果</span></span>
<span class="line">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 用于支持异步回调</span></span>
<span class="line">        _self<span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取出异步任务中缓存的回调函数并执行</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 失败时的状态翻转函数</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>_self<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">      _self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      _self<span class="token punctuation">.</span>result <span class="token operator">=</span> err<span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        _self<span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token comment">// 执行器执行，由此看出在new promise时，executor中的同步代码是同步执行的</span></span>
<span class="line">      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 接受成功和失败时的回调函数</span></span>
<span class="line">    <span class="token keyword">const</span> _self <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// 同样保存一下this方便使用</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// then 返回一个新的promise</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断回调函数的返回值是否为promise，若为promise则根据其结果返回，否则直接返回回调函数的调用结果</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>_self<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">res</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token function">res</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">rej</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// executor中执行同步任务后翻转了状态则直接运行回调</span></span>
<span class="line">        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 立即加入宏任务队列中，支持回调异步任务</span></span>
<span class="line">          <span class="token function">callback</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">callback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 当executor中的执行的是异步任务，此时状态为pending，需要将回调函数推入缓存，待到状态翻转时再调用</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token function-variable function">onResolved</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">callback</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="line">          <span class="token function-variable function">onRejected</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">callback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// catch是then的语法糖，仅接收onRejected</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 绑定在类上的resolve方法，传入promise时，根据其结果返回状态，否则返回成功的且结果为data的新promise对象</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        data<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">res</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">res</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 返回新的promise对象，状态为rejected，结果为err</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token function">rej</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 传入promise数组，当所有promise都成功时返回成功的promise，结果是所有promise成功结果组成的数组，当有一个promise失败时直接返回失败的结果</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span></span>
<span class="line">          <span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">            count<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 翻转数量和promise长度相同时，翻转返回新promise对象的状态</span></span>
<span class="line">              <span class="token function">res</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 当第一个promise翻转状态时直接返回相同状态的新promise对象</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">res</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">rej</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promises<span class="token punctuation">,</span> concurrency</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// map实现多个promise数组并发控制，最多同时运行concurrency个promise任务</span></span>
<span class="line">    <span class="token keyword">let</span> curIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> resolvedCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> index <span class="token operator">=</span> curIndex<span class="token punctuation">;</span></span>
<span class="line">        curIndex<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          promises<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            resolvedCount<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>resolvedCount <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">res</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//上一个promise任务执行完成后执行下一个next任务</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> concurrency<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 控制最多同时运行concurrency个next任务</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="async-await和generator-yield" tabindex="-1"><a class="header-anchor" href="#async-await和generator-yield"><span>async/await和generator/yield</span></a></h3><p>async/await是generator/yield的语法糖，<br> generator提供了新的异步方式，遇到yield时暂停程序运行，向外交出执行权，直到外部调用了next方法再回到程序内部继续执行<br> async/await内置了自动执行器，自动将generator交出的执行权交还给generator</p><ul><li>手写async/await实现</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">asyncGeneratorStep</span><span class="token punctuation">(</span><span class="token parameter">gen<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> _next<span class="token punctuation">,</span> _throw<span class="token punctuation">,</span> key<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">var</span> info <span class="token operator">=</span> gen<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// gen.next(arg) 或 gen.throw(arg)</span></span>
<span class="line">      <span class="token keyword">var</span> val <span class="token operator">=</span> info<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">resolve</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 使用promise.resolve的方式能同时支持同步和异步任务val</span></span>
<span class="line">      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>_next<span class="token punctuation">,</span> _throw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">_asyncToGeneratorWrapper</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 返回包装后的函数</span></span>
<span class="line">      <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> gen <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">_next</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 执行器中传入_next未完成时自动循环执行</span></span>
<span class="line">          Demo<span class="token punctuation">.</span><span class="token function">asyncGeneratorStep</span><span class="token punctuation">(</span>gen<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> _next<span class="token punctuation">,</span> _throw<span class="token punctuation">,</span> <span class="token string">&#39;next&#39;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">_throw</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          Demo<span class="token punctuation">.</span><span class="token function">asyncGeneratorStep</span><span class="token punctuation">(</span>gen<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> _next<span class="token punctuation">,</span> _throw<span class="token punctuation">,</span> <span class="token string">&#39;throw&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">_next</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动首次运行</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 测试用例</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">testFn</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;promise resolve: &#39;</span><span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">testGen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;start run gen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">testFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">testFn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>      </span>
<span class="line">      <span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">testFn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> res3<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> runner <span class="token operator">=</span> Demo<span class="token punctuation">.</span><span class="token function">_asyncToGeneratorWrapper</span><span class="token punctuation">(</span>testGen<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">end with: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">Demo<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理"><span>错误处理</span></a></h3><ul><li>回调函数错误捕获</li></ul><p>因为事件循环机制，异步任务执行时，发布该异步任务的执行栈fun1已经退出，因此在外部无法捕获异步任务中的抛出的错误；</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无法捕获错误</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>promise错误捕获</li></ul><p>异步任务抛出的错误需要在异步任务内部catch，对于promise来说，由于then/catch/finally已经捕获了错误并将返回的promise状态翻转为rejected,因此其错误捕获使用then/catch，若抛出错误后续没有catch，则对应错误会冒泡到主执行栈</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 同样无法捕获</span></span>
<span class="line">    <span class="token comment">// 仍然要在异步任务中进行捕获，并且通过将 promise 状态翻转的将错误传递给返回的promise对象</span></span>
<span class="line">    <span class="token comment">// try {</span></span>
<span class="line">    <span class="token comment">//   throw new Error(&#39;error&#39;)</span></span>
<span class="line">    <span class="token comment">// } catch (e){</span></span>
<span class="line">    <span class="token comment">//   reject(e)</span></span>
<span class="line">    <span class="token comment">// }</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// a is rejected promise</span></span>
<span class="line"><span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;b throw a new error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// throw a error in callback will be wrapped and return rejected promise</span></span>
<span class="line">  <span class="token comment">// after throw error blow code will not being run</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token comment">// a&#39;s error catch by onrejected callback function, but throw new error so b is rejected promise</span></span>
<span class="line"><span class="token comment">// promise b must being catch, otherwise the error will throw in global scope</span></span>
<span class="line"><span class="token keyword">var</span> c <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c is fulfilled promise</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PS: promise chain 无法被真正意义上的打破，即使是finally仍然会返回一个promise对象，若之前的对象处于pending状态则调用then方法后的promise对象也处于pending状态，因此无法阻止返回promise对象，无法阻断promise chain</p><ul><li>async/await 错误捕获</li></ul><p>async/await 实际上是generator/yield结合promise的语法糖，其修饰的函数返回值为promise</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return value of success or undefined</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// code on here like in then onResolved</span></span>
<span class="line">    <span class="token comment">// when fun1 return/is rejected promise code on here will not execute</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// code on here like in catch onRejected</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// recommend catch error code style like go syntax</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> res<span class="token punctuation">]</span> <span class="token keyword">await</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> v<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span>e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// handle error</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="补充说明" tabindex="-1"><a class="header-anchor" href="#补充说明"><span>补充说明</span></a></h2><p>import模块加载时，传入目录，则优先加载目录下package.json文件中main属性指定的入口，其次是index.js文件；若都没找到则报错</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: vitotu@qq.com">vito</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DC0QBOlX.js" defer></script>
  </body>
</html>
